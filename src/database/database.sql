CREATE DATABASE itsdatabase


/* USER'S TABLE */
/*
* ROLE = [STUDENT, TEACHER, ADMIN, SUSER]
! Finish
*/
CREATE TABLE users (
	id int(50) PRIMARY KEY NOT null AUTO_INCREMENT,
    last_name varchar(50),
    name varchar(50),
    cuil varchar(50),
    dir varchar(100),
    phone_number varchar(50),
    birthdate varchar(20),
    age int(20),
    email varchar(200),
    user_name varchar(200),
    pass varchar(200),
    role varchar(20),
    file_number varchar(200)
)

/* CAREER'S TABLE
! Finish
*/
CREATE TABLE career (
	id int(10) PRIMARY KEY NOT null AUTO_INCREMENT,
    name varchar(200),
    description varchar(500),
    duration varchar(200)
)

/* MATERIA'S TABLE 
* ONE MATERIA HAS A ONLY PROFESSOR
! RELATIONAL TABLE
!Finish
*/
CREATE TABLE materia(
	id int(10) PRIMARY key not null AUTO_INCREMENT,
    name varchar(200),
    professor_id int(10),
    actual_year varchar(50),
    classes_quantity int(50),
    career_id int(10),
    FOREIGN KEY (career_id) REFERENCES career(id),
    FOREIGN KEY (professor_id) REFERENCES users(id)
)

/* SCHEDULES'S TABLE 
! Finish
*/
CREATE TABLE schedules (
	id int(10) PRIMARY key not null,
    class_day varchar(20),
    class_schedule varchar(20)
)

/* ATTENDANCE'S TABLE 
* INFORMATION GENERATED BY THE QR
! RELATIONAL TABLE
la materia tiene sus horarios, lo mejor seria colocar eso
para usar: un droplist que muestre las materias del profesor
al hacer click sobre la materia, consultar la tabla materia_has_schedules, que
contiene los horarios de la materia.
con esa info, hacer el qr (el qr tiene que tener el dia)
hacer un timestamp desde el front
! todos estos datos se pueden conseguir
QR generado:
{id: id, day: attendance_day, professor: professor_name, last_name: professor_last_name,materia: materia_name}
! Finish
*/
CREATE TABLE attendance (
	id int(50) PRIMARY key not null AUTO_INCREMENT,
    attendance_date varchar(50),
    professor_id int(10),
    materia_id int(10),
    schedule_id int(10),
    FOREIGN KEY (professor_id) REFERENCES users(id),
    FOREIGN KEY (materia_id) REFERENCES materia(id),
    FOREIGN KEY (schedule_id) REFERENCES schedules(id)
)

/*
? TENER EN CUENTA QUE LOS PROFESORES SE BUSCAN EN LAS MATERIAS (nombre y apellido),
? Y LOS ALUMNOS SE BUSCAN EN LAS INSCRIPCIONES (nombre y apellido)
*/

/*
! --------------------------- RELATIONAL TABLES ---------------------------
*/

/* STUDENTS (USERS) ENROLL IN MATERIA 
! Finish
*/
CREATE TABLE inscriptions (
	id int(50) PRIMARY KEY not null AUTO_INCREMENT,
    student_id int(10),
    materia_id int(10),
    FOREIGN KEY (student_id) REFERENCES users(id),
    FOREIGN KEY (materia_id) REFERENCES materia(id)
)

/* CAREER CONTAINS MATERIA 
! Finish
*/
CREATE TABLE career_contains_materia (
	id int(10) PRIMARY KEY not null AUTO_INCREMENT,
    materia_id int(10),
    career_id int(10),
    FOREIGN KEY (materia_id) REFERENCES materia(id),
    FOREIGN KEY (career_id) REFERENCES career(id)
)

/* MATERIA HAS SCHEDULES 
! Finish
*/
CREATE TABLE materia_has_schedules (
	id int(10) PRIMARY KEY not null AUTO_INCREMENT,
    materia_id int(10),
    schedule_id int(10),
    FOREIGN KEY (materia_id) REFERENCES materia(id),
    FOREIGN KEY (schedule_id) REFERENCES schedules(id)
)

/* SCHEDULE REGISTER ATTENDANCES 
TODO Ver si realmente se necesita registrar el horario con la asistencia! (en la tabla attendance ya se hace eso)
*/
CREATE TABLE schedule_register_attendance (
	id int(50) PRIMARY KEY not null AUTO_INCREMENT,
    schedule_id int(10),
    attendance_id int(50),
    FOREIGN KEY (schedule_id) REFERENCES schedule(id),
    FOREIGN KEY (attendance_id) REFERENCES attendance(id)
)

/* USERS REGISTER ATTENDANCE */
CREATE TABLE user_register_attendance (
	id int(50) PRIMARY KEY not null AUTO_INCREMENT,
    student_id int(50),
    attendance_id int(50),
    FOREIGN KEY (student_id) REFERENCES users(id),
    FOREIGN KEY (attendance_id) REFERENCES attendance(id)
)

/*
! SOME SQL QUERIES
*/

'select * from career C
inner join materia M
on C.id = M.career_id
order by C.id'